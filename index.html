/* Save Score with auto-highlight */
function saveScore(game) {
    if (savedRows[game]) return;

    let home = parseInt(document.getElementById("homeScore" + game).value) || 0;
    let away = parseInt(document.getElementById("awayScore" + game).value) || 0;

    if (home < 21 && away < 21) {
        if (home > away) away = 21;
        else if (away > home) home = 21;
    }

    totalHome += home;
    totalAway += away;
    savedRows[game] = true;

    let row = document.getElementById("row" + game);

    if (home > away) {
        row.style.backgroundColor = "#2e8b57";
    } else if (away > home) {
        row.style.backgroundColor = "#1e90ff";
    } else {
        row.style.backgroundColor = "#145214";
    }

    document.getElementById("totalsRow").innerHTML =
        `Running Totals: Home: ${totalHome} &nbsp;&nbsp;&nbsp; Away: ${totalAway}`;
}

/* Clear Row */
function clearRow(game) {
    if (savedRows[game]) {
        let home = parseInt(document.getElementById("homeScore" + game).value) || 0;
        let away = parseInt(document.getElementById("awayScore" + game).value) || 0;

        if (home < 21 && away < 21) {
            if (home > away) away = 21;
            else if (away > home) home = 21;
        }

        totalHome -= home;
        totalAway -= away;
        delete savedRows[game];
    }

    document.getElementById("homePlayer" + game).value = "";
    document.getElementById("awayPlayer" + game).value = "";
    document.getElementById("homeScore" + game).value = "";
    document.getElementById("awayScore" + game).value = "";

    document.getElementById("row" + game).style.backgroundColor = "#145214";

    document.getElementById("totalsRow").innerHTML =
        `Running Totals: Home: ${totalHome} &nbsp;&nbsp;&nbsp; Away: ${totalAway}`;
}

/* Reset Match */
function resetMatch() {
    totalHome = 0;
    totalAway = 0;
    savedRows = {};

    document.getElementById("topControls").style.display = "block";
    document.getElementById("showControlsBtn").style.display = "none";

    createGrid(lastMatchSize);
}

/* TV MODE */
function enterTvMode() {
    document.documentElement.classList.add("tv-mode");
    document.getElementById("exitTvFloating").style.display = "inline-block";
}

function exitTvMode() {
    document.documentElement.classList.remove("tv-mode");
    document.getElementById("exitTvFloating").style.display = "none";
}

/* Printable Match Sheet */
function printMatchSheet() {
    if (!document.getElementById("scoreTable").innerHTML.trim()) {
        alert("Please create a match grid before printing.");
        return;
    }

    let win = window.open("", "PrintMatch", "width=900,height=700");
    let now = new Date().toLocaleString();

    let html = `
        <html>
        <head>
            <title>Match Sheet</title>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    padding: 20px;
                    background: #ffffff;
                    color: #000000;
                    font-size: 14px;
                }
                h2 {
                    text-align: center;
                    font-size: 24px;
                    margin-bottom: 5px;
                }
                h3 {
                    text-align: center;
                    font-size: 18px;
                    margin-top: 0;
                    margin-bottom: 20px;
                }
                table {
                    width: 100%;
                    border-collapse: collapse;
                    margin-top: 10px;
                    font-size: 14px;
                }
                table, th, td {
                    border: 1px solid #000;
                }
                th, td {
                    padding: 6px;
                    text-align: center;
                }
                #totalsRow {
                    font-weight: bold;
                }
            </style>
        </head>
        <body>
            <h2>Crown Green Bowls Match Sheet</h2>
            <h3>${homeTeamHeading} vs ${awayTeamHeading}</h3>
            <p><strong>Date/Time:</strong> ${now}</p>
            <table>
                ${document.getElementById("scoreTable").innerHTML}
            </table>
        </body>
        </html>
    `;

    win.document.open();
    win.document.write(html);
    win.document.close();
    win.focus();
    win.print();
}
</script>

</body>
</html>
